{% macro render_tree(vault, page_editor, current_path, current_dir) %}
<link href="https://cdn.jsdelivr.net/npm/jquery.fancytree/dist/skin-lion/ui.fancytree.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery.fancytree/dist/jquery.fancytree-all-deps.min.js"></script>

<div id="tree"></div>

<script>
    let currentPath = "{{ current_path }}";
    let currentDir =  "{{ current_dir }}";
    if (!currentPath) {
        currentPath = currentDir;
    }
    $("#tree").fancytree({
        source: { url: "{{url_for('tree', vault=vault)}}/?edit={{page_editor}}" },
        lazyLoad: function (event, data) {
            let node = data.node;
            let url = "{{ url_for('tree', vault=vault) }}/" + encodeURIComponent(node.key) + "?edit={{page_editor}}";
            data.result = { url: url };
        },
        activate: function (event, data) {
            let node = data.node;
            if (node.data.url) {
                window.location.href = node.data.url;
            }
        },
        init: function (event, data) {
            if (currentPath) {
                let tree = data.tree;
                // попробуем найти узел по key
                let node = tree.getNodeByKey(currentPath);
                if (node) {
                    node.setActive(true);   // select
                    node.makeVisible();     // expand
                } else {
                    console.log("Tree path not found:", currentPath);
                }
            }
        }
    });
</script>

{% endmacro %}

{{render_tree(vault, True)}}